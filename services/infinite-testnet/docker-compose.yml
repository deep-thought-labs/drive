services:
  infinite-testnet:
    # Core service settings (image, name, user, restart) - not expected to be modified by users
    image: deepthoughtlabs/infinite-drive:latest
    container_name: infinite-testnet
    # User configuration: Uses environment variables PUID and PGID if set, otherwise defaults to 1000:1000
    # To fix permission issues, set these before running docker-compose:
    #   Without sudo: export PUID=$(id -u) && export PGID=$(id -g)
    #   With sudo:    export PUID=${SUDO_UID:-$(id -u)} && export PGID=${SUDO_GID:-$(id -g)}
    # Or run inline: PUID=$(id -u) PGID=$(id -g) docker-compose up -d
    # Note: Works with or without sudo - if using sudo, it will use SUDO_UID/SUDO_GID automatically
    user: "${PUID:-1000}:${PGID:-1000}"
    restart: unless-stopped

    ##################################################################################
    #                       Editable Section Starts Here                             #
    # Customize ports, volumes, and environment variables as needed below.           #
    ##################################################################################

    ports:
      # Ports mapping: Expose internal container ports to the host
      #
      # Format: "HOST_PORT:CONTAINER_PORT"
      # - HOST_PORT: Port on your machine (can be changed to avoid conflicts)
      # - CONTAINER_PORT: Fixed internal port (do not change: P2P is 26656, RPC is 26657)
      #
      # Port Allocation Strategy (see docs/PORT_ALLOCATION.md):
      # - Mainnet: 26656 (P2P), 26657 (RPC) - Standard ports
      # - Testnet: 26666 (P2P), 26667 (RPC) - +10 from standard (allows simultaneous execution)
      # - Creative: 26676 (P2P), 26677 (RPC) - +20 from standard
      #
      # NOTE: These ports are different from mainnet to allow running both networks simultaneously.
      # If you only run testnet (not mainnet), you can change these to 26656:26656 and 26657:26657
      #
      # P2P port for network communication
      - "26666:26656"
      #
      # RPC port for API access
      - "26667:26657"
    
    volumes:
      # Volumes: Persist data outside the container to avoid loss on restart/stop
      #
      # Format: "host/path:container/path"
      # - This mounts './persistent-data' on host to '/home/ubuntu/.infinited' inside container
      # - Purpose: Keeps blockchain data (config, keys, state) safe and persistent
      #
      # Note: Do not modify unless you need a custom data location (not recommended for most users).
      #
      # Examples (include the guion - at the beginning of the line):
      # - ./persistent-data:/home/ubuntu/.infinited             # Default local folder
      # - /mnt/external-drive/infinite-testnet:/home/ubuntu/.infinited  # Store on external drive
      # - /data/infinite-testnet:/home/ubuntu/.infinited                # Store on a dedicated partition or folder
      - ./persistent-data:/home/ubuntu/.infinited

    environment:
      # Environment variables: Required and Optional variables used for the node configuration.

      ##################################################################################
      #                           Chain Identification                                 #
      ##################################################################################
      NODE_CHAIN_ID: "infinite_421018001-1"  # Chain ID for the Infinite Testnet network
      NODE_EVM_CHAIN_ID: "421018001"         # EVM Chain ID for compatibility
      NODE_GENESIS_URL: "https://raw.githubusercontent.com/deep-thought-labs/drive/main/services/infinite-testnet/genesis.json"  

      ##################################################################################
      #                           Network P2P Configuration                            #
      ##################################################################################

      # Seed nodes for P2P discovery
      #
      # format for single seed:    "id@ip:port"
      # format using domain names: "id@domain.com:port" or "id@subdomain.domain.com:port"
      # When using multiple seeds, use a comma to separate them: "id1@ip1:port,id2@example.com:port,id3@ip3:port"
      #
      # example: NODE_P2P_SEEDS: "71a48afac2463a77bc5825d78dd83299174c4a6c@seed1.infinitedrive.xyz:26656"
      #
      # TODO: Update with official testnet seed nodes when available
      # (required for initial connection)
      NODE_P2P_SEEDS: "" 

    ### End environment variables
  ### End service infinite-testnet
### End docker-compose.yml

