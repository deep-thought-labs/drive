# HTTP Basic Authentication Configuration
# Purpose: Protect routes with username/password authentication
#
# Usage:
# 1. Generate password file:
#    docker compose exec nginx htpasswd -c /etc/nginx/.htpasswd username
#    (For additional users, omit -c flag)
# 2. Copy this file to persistent-data/conf.d/basic-auth.conf
# 3. Modify the password file path and protected locations
# 4. Test: docker compose exec nginx nginx -t
# 5. Reload: docker compose exec nginx nginx -s reload
#
# Note: You need to create the password file first using htpasswd

server {
    listen 80;
    listen [::]:80;
    server_name localhost;
    
    root /usr/share/nginx/html;
    index index.html;
    
    # MODIFY: Protected location (admin area)
    location /admin/ {
        # MODIFY: Path to password file
        # Create this file using: htpasswd -c /etc/nginx/.htpasswd username
        # The file should be in persistent-data/ and mounted to /etc/nginx/.htpasswd
        auth_basic "Restricted Area";
        auth_basic_user_file /etc/nginx/.htpasswd;
        
        # Your protected content here
        try_files $uri $uri/ =404;
    }
    
    # MODIFY: Another protected location example
    # location /api/secure/ {
    #     auth_basic "API Authentication Required";
    #     auth_basic_user_file /etc/nginx/.htpasswd;
    #     
    #     proxy_pass http://localhost:8080;
    # }
    
    # MODIFY: Public location (no authentication)
    location / {
        try_files $uri $uri/ =404;
    }
    
    # MODIFY: Exception - allow access to specific files without auth
    # location /public/ {
    #     try_files $uri $uri/ =404;
    # }
}

# Instructions for creating password file:
#
# 1. Create password file (first user, creates file):
#    docker compose exec nginx htpasswd -c /etc/nginx/.htpasswd admin
#    (Enter password when prompted)
#
# 2. Add additional users (omit -c flag):
#    docker compose exec nginx htpasswd /etc/nginx/.htpasswd user2
#
# 3. To persist the file, you need to:
#    - Create persistent-data/.htpasswd on host
#    - Add volume mount in docker-compose.yml:
#      - ./persistent-data/.htpasswd:/etc/nginx/.htpasswd:ro
#    - Then use: htpasswd -c persistent-data/.htpasswd username
#
# Note: The password file is stored in plain text format but passwords are hashed.

