# File Downloads Configuration
# Purpose: Serve downloadable files from a specific directory/endpoint
# 
# Usage:
# 1. Copy this file to persistent-data/conf.d/file-downloads.conf
# 2. Modify the paths and settings below as needed
# 3. Create the downloads directory: mkdir -p persistent-data/html/downloads
# 4. Place your files in persistent-data/html/downloads/
# 5. Test: docker compose exec nginx nginx -t
# 6. Reload: docker compose exec nginx nginx -s reload
#
# Access files at: http://localhost/downloads/filename.ext

server {
    listen 80;
    listen [::]:80;
    server_name localhost;

    # MODIFY: Change this to your desired download path
    # Example: /files, /downloads, /static, etc.
    location /downloads {
        # MODIFY: Path to your downloads directory inside the container
        # This maps to: persistent-data/html/downloads/
        alias /usr/share/nginx/html/downloads;
        
        # Enable directory listing (optional)
        # Set to 'off' to disable directory listing
        autoindex on;
        
        # MODIFY: Customize directory listing style (optional)
        # Options: html, json, xml, jsonp
        autoindex_format html;
        
        # MODIFY: Show file sizes in directory listing
        autoindex_exact_size off;  # Shows human-readable sizes (KB, MB)
        # autoindex_exact_size on;  # Shows exact bytes
        
        # MODIFY: Show file modification times
        autoindex_localtime on;  # Shows local time
        # autoindex_localtime off; # Shows GMT time
        
        # Set proper MIME types for common file types
        # This ensures browsers handle files correctly
        default_type application/octet-stream;
        
        # MODIFY: Add specific MIME types if needed
        types {
            application/pdf pdf;
            application/zip zip;
            application/x-tar tar;
            application/x-gzip gz tgz;
            image/jpeg jpg jpeg;
            image/png png;
            image/gif gif;
            text/plain txt;
            text/html html htm;
        }
        
        # MODIFY: Force download for specific file types (optional)
        # Uncomment and modify as needed
        # location ~* \.(pdf|zip|tar|gz)$ {
        #     add_header Content-Disposition "attachment";
        # }
        
        # MODIFY: Set file size limit (optional)
        # Default is 1MB, increase if needed
        client_max_body_size 100M;
        
        # Security: Deny access to hidden files
        location ~ /\. {
            deny all;
            access_log off;
            log_not_found off;
        }
        
        # Optional: Add CORS headers if serving files to web applications
        # Uncomment if needed
        # add_header Access-Control-Allow-Origin "*";
        # add_header Access-Control-Allow-Methods "GET, OPTIONS";
        # add_header Access-Control-Allow-Headers "Range";
    }
    
    # MODIFY: Add more download locations if needed
    # Example for a second download area:
    # location /files {
    #     alias /usr/share/nginx/html/files;
    #     autoindex on;
    #     autoindex_format html;
    # }
}

