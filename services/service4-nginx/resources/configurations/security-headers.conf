# Security Headers Configuration
# Purpose: Add security headers to all responses
#
# Usage:
# 1. Copy this file to persistent-data/conf.d/security-headers.conf
# 2. Modify the security policies as needed
# 3. Can be used as a complete server block or included as snippet
# 4. Test: docker compose exec nginx nginx -t
# 5. Reload: docker compose exec nginx nginx -s reload
#
# Note: This can also be used as a snippet by including it in other server blocks

server {
    listen 80;
    listen [::]:80;
    server_name localhost;
    
    root /usr/share/nginx/html;
    index index.html;
    
    # MODIFY: Content Security Policy (CSP)
    # Adjust based on your application's needs
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'self';" always;
    
    # MODIFY: Strict CSP (more secure, may break some apps)
    # Uncomment if you want stricter CSP:
    # add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self';" always;
    
    # X-Frame-Options: Prevent clickjacking
    add_header X-Frame-Options "SAMEORIGIN" always;
    # Options: DENY (no framing), SAMEORIGIN (same origin only), ALLOW-FROM uri
    
    # X-Content-Type-Options: Prevent MIME type sniffing
    add_header X-Content-Type-Options "nosniff" always;
    
    # X-XSS-Protection: Enable XSS filter
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Referrer-Policy: Control referrer information
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    # Options: no-referrer, no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
    
    # Permissions-Policy: Control browser features
    add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;
    # MODIFY: Adjust based on features your app needs
    
    # Remove server version from headers
    server_tokens off;
    
    # Hide Nginx version in error pages
    more_clear_headers Server;
    
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Deny access to hidden files
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}

# Alternative: Use as snippet in other server blocks
# Add this to your server block:
# include /etc/nginx/conf.d/security-headers-snippet.conf;
#
# Then create security-headers-snippet.conf with just the add_header directives

